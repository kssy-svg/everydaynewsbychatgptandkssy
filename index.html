<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jiffcy風リアルタイムチャット & ニュース</title>
<style>
body { font-family:sans-serif; margin:0; background:#111; color:#fff; display:flex; flex-direction:column; height:100vh; }
nav { display:flex; padding:10px; background:#222; }
nav button { margin-right:10px; padding:6px 12px; cursor:pointer; color:#fff; background:#555; border:none; border-radius:4px; }
nav button.active { background:#0af; }
section { display:none; flex:1; height:calc(100vh - 50px); overflow:auto; }
section.active { display:flex; flex-direction:column; }
#chat { display:flex; flex-direction:column; flex:1; justify-content:space-between; padding:10px; }
#top,#bottom { flex:1; display:flex; justify-content:center; align-items:center; font-size:3em; border-bottom:1px solid #444; }
#bottom { border-bottom:none; }
input { width:90%; padding:10px; font-size:1.2em; border-radius:8px; border:none; }
#news ul { list-style:none; padding:0; }
#news li { margin-bottom:10px; cursor:pointer; text-decoration:underline; color:#0af; }
</style>
</head>
<body>
<nav>
<button id="tab-news">ニュース</button>
<button id="tab-chat" class="active">チャット</button>
</nav>

<section id="news-section">
<div id="news">読み込み中…</div>
</section>

<section id="chat-section" class="active">
<div id="chat">
  <div id="top">自分の文字</div>
  <div id="bottom">相手の文字</div>
  <input id="input" placeholder="文字を打つと上にリアルタイム表示">
</div>
</section>

<script type="module">
  // Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

  // Firebase構成（かっしーのプロジェクトに置き換え済み）
  const firebaseConfig = {
    apiKey: "AIzaSyCa18VmW_bGfThWTmfCxFr_ygWA-nGMxxc",
    authDomain: "jiffcylikechat.firebaseapp.com",
    databaseURL: "https://jiffcylikechat-default-rtdb.firebaseio.com",
    projectId: "jiffcylikechat",
    storageBucket: "jiffcylikechat.firebasestorage.app",
    messagingSenderId: "60268594687",
    appId: "1:60268594687:web:f3ae6dca6b58d0f63893ca"
  };

  // Firebase初期化
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // タブ切り替え
  const newsBtn = document.getElementById("tab-news");
  const chatBtn = document.getElementById("tab-chat");
  const newsSec = document.getElementById("news-section");
  const chatSec = document.getElementById("chat-section");

  newsBtn.addEventListener("click", ()=>{
    newsSec.classList.add("active");
    chatSec.classList.remove("active");
    newsBtn.classList.add("active");
    chatBtn.classList.remove("active");
  });
  chatBtn.addEventListener("click", ()=>{
    chatSec.classList.add("active");
    newsSec.classList.remove("active");
    chatBtn.classList.add("active");
    newsBtn.classList.remove("active");
  });

  // ニュース取得
  async function fetchNews() {
    const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent('https://news.yahoo.co.jp/rss/topics/top-picks.xml');
    try {
      const res = await fetch(proxyUrl);
      const data = await res.json();
      const parser = new DOMParser();
      const xml = parser.parseFromString(data.contents, "text/xml");
      const items = xml.querySelectorAll("item");
      let html = "<ul>";
      items.forEach(item=>{
        const title = item.querySelector("title").textContent;
        const link = item.querySelector("link").textContent;
        html += `<li onclick="window.open('${link}','_blank')">${title}</li>`;
      });
      html += "</ul>";
      document.getElementById("news").innerHTML = html;
    } catch(e) {
      document.getElementById("news").textContent = "ニュースの取得に失敗しました"
    }
  }
  fetchNews();

  // チャット処理
  const top = document.getElementById("top");
  const bottom = document.getElementById("bottom");
  const input = document.getElementById("input");

  // 自分の文字を書き込み
  input.addEventListener("input", ()=>{
    top.textContent = input.value;
    set(ref(db,'chat/myText'), input.value);
  });

  // 相手の文字を監視して表示
  onValue(ref(db,'chat/otherText'), (snapshot)=>{
    const val = snapshot.val() || "";
    bottom.textContent = val;
  });

</script>
</body>
</html>
